<ng-container *ngIf="ready; else loading">

  <h1 class="text-2xl font-bold" style="color: var(--primary-color)" i18n>References</h1>
  <p class="p-text-secondary" i18n>This section requires you to provide a minimum of 1 and a maximum of 3 work-related references. Once you save a reference, an e-mail will be sent to the referee immediately. You may follow the status of your referees’ submissions as long as the registration phase is open. This section will not be considered complete until at least one referee completes the questionnaire.</p>
  <div class="flex justify-end py-4">
    <button pButton class="p-button-rounded" icon="pi pi-plus" [disabled]="references.length>=3" label="Add" i18n-label
      (click)="openAddReferenceDialog()"></button>
  </div>
  <div class="p-grid">
    <div *ngIf="references.length === 0" class="p-col-12 py-8 text-center">
      <span class="text-sm text-gray-700" i18n>You haven't added any references yet</span>
    </div>

    <div class="p-col-12" *ngFor="let reference of references; let index = index">
      <app-program-section-info-card [showEditButton]="reference.isCompleted? false: true"
        (onEdit)="openReferenceDialogForEditing(reference)" [showDeleteButton]="reference.isCompleted? false: true"
        (onDelete)="removeReference(reference)">
        <div class="flex flex-col justify-around">
          <div class="text-lg font-semibold pb-2" i18n>{{ reference | lang:'fullName' }}</div>
          <div class="text-gray-600 pb-1">
            <ng-container i18n>Job Title</ng-container>: {{ reference | lang:'jobTitle' }}
          </div>
          <div class="text-gray-600">
            <ng-container i18n>Organization</ng-container>: {{ reference | lang:'organizationName' }}
          </div>
          <div class="text-gray-600">
            <ng-container i18n>Mobile</ng-container>: {{ reference.mobile }}
          </div>
          <div class="text-gray-600">
            <ng-container i18n>Email</ng-container>: {{ reference.email }}
          </div>
          <div *ngIf="reference.isCompleted" class="text-green-600" i18n>Referee Completed</div>
          <div *ngIf="!reference.isCompleted" class="text-red-500" i18n>Pending Referee</div>
        </div>
      </app-program-section-info-card>
    </div>

    <div class="p-col-12 flex justify-between mt-8">
      <button pButton type="button" label="Back" i18n-label class="w-32" (click)="goToBackForm()"></button>
      <button pButton type="button" label="Next" i18n-label class="w-32" [disabled]="references.length === 0"
        (click)="goToNextForm()"></button>
    </div>
  </div>
</ng-container>

<p-dialog header="Add Reference" i18n-header [(visible)]="showReferenceDialog" [modal]="true" [focusTrap]="true"
  [focusOnShow]="true" [draggable]="false" styleClass="w-full max-w-sm lg:max-w-screen-md">
  <form [formGroup]="referenceForm" class="p-fluid p-formgrid p-grid"
    (ngSubmit)="editingReference.id ? updateReference() : addReference()">
    <div class="p-field p-col-6">
      <label for="fullName">Full Name <span class="text-red-500">*</span></label>
      <input pInputText formControlName="fullName" type="text" id="fullName" placeholder="Enter Fullname">
      <small appControlValidationError controlName="fullName" class="p-invalid"></small>
    </div>
    <div class="p-field p-col-6" dir="rtl">
      <label for="fullName_AR">الاسم الكامل <span class="text-red-500">*</span></label>
      <input pInputText formControlName="fullName_AR" type="text" id="fullName_AR" placeholder="أدخل الاسم الكامل">
      <small appControlValidationError controlName="fullName_AR" class="p-invalid"></small>
    </div>
    <div class="p-field p-col-12 p-md-6">
      <label for="mobile" i18n>Mobile <span class="text-red-500">*</span></label>
      <app-phone-number appValidatePhoneNumber formControlName="mobile" inputId="mobile"></app-phone-number>
      <small appControlValidationError controlName="mobile" class="p-invalid"></small>
    </div>
    <div class="p-field p-col-12 p-md-6">
      <label for="email" i18n>Email <span class="text-red-500">*</span></label>
      <input pInputText formControlName="email" type="email" id="email" placeholder="Enter Email" i18n-placeholder>
      <small appControlValidationError controlName="email" class="p-invalid"></small>
    </div>
    <div class="p-field p-col-6">
      <label for="jobTitle">Job Title <span class="text-red-500">*</span></label>
      <input pInputText formControlName="jobTitle" type="text" id="jobTitle" placeholder="Enter Job Title">
      <small appControlValidationError controlName="jobTitle" class="p-invalid"></small>
    </div>
    <div class="p-field p-col-6" dir="rtl">
      <label for="jobTitle_AR">المسمى الوظيفي <span class="text-red-500">*</span></label>
      <input pInputText formControlName="jobTitle_AR" type="text" id="jobTitle_AR" placeholder="أدخل المسمى الوظيفي">
      <small appControlValidationError controlName="jobTitle_AR" class="p-invalid"></small>
    </div>
    <div class="p-field p-col-6">
      <label for="organizationName">Organization <span class="text-red-500">*</span></label>
      <input pInputText formControlName="organizationName" type="text" id="organizationName"
        placeholder="Enter Organization Name">
      <small appControlValidationError controlName="organizationName" class="p-invalid"></small>
    </div>
    <div class="p-field p-col-6" dir="rtl">
      <label for="organizationName_AR">الجهة <span class="text-red-500">*</span></label>
      <input pInputText formControlName="organizationName_AR" type="text" id="organizationName_AR"
        placeholder="أدخل اسم المنظمة">
      <small appControlValidationError controlName="organizationName_AR" class="p-invalid"></small>
    </div>
    <div class="mt-5 p-col text-center">
      <p-button [disabled]="referenceForm.invalid || isFormSubmitting" class="p-button-md" type="submit"
        icon="pi pi-plus" label="Save" i18n-label></p-button>
    </div>
  </form>
</p-dialog>

<p-confirmDialog appPrimeNGi18n header="Confirmation" i18n-header icon="pi pi-exclamation-triangle"
  styleClass="w-full max-w-sm">
</p-confirmDialog>


<ng-template #loading>
  <div class="flex flex-grow justify-center items-center py-8">
    <p-progressSpinner></p-progressSpinner>
  </div>
</ng-template>